import{C as V,R as T,T as Be,V as xe,S as re,a as ce,G as R,M as w,b as ve,D as J,c as N,d as E,e as Y,f as L,g as Me,B as O,h as f,Q as fe,i as Ce,j as Q,k as Le,l as Oe,m as qe,n as We,o as He,P as Ue,W as $e,p as _e,q as Ye,r as Xe,s as Ae,t as ke,u as be,v as je,A as Ke,w as Qe,x as Je,y as Ze,z as K}from"./vendor-ewAQsO2N.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const M=6,g=10,F=4,Ge=350,et=300,tt=g-1.5,it=10506797,ot=4004866,at=.6,nt=.05,st=.3,rt=1.5,ct=1,lt=1.2,ut=1;class ht{constructor(){this.audioContext=null,this.sounds={},this.musicNodes=null,this.musicPlaying=!1,this.soundEffectsVolume=st,this.musicVolume=nt,this.lastScheduledTime=0,this.loopCheckInterval=null}init(){try{if(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.state==="suspended"){const e=async()=>{await this.audioContext.resume(),["touchstart","touchend","click"].forEach(t=>{document.removeEventListener(t,e)})};["touchstart","touchend","click"].forEach(t=>{document.addEventListener(t,e)})}}catch(e){console.error("Web Audio API not supported:",e)}this.loadSounds(),this.createMusicControls(),this.createVolumeControls(),this.createBackgroundMusic()}loadSounds(){this.audioContext&&(this.sounds={drop:()=>this.playDropSound(),hit:()=>this.playCollisionSound(),merge:()=>this.playMergeSound()})}playDropSound(){if(!this.audioContext)return;const e=this.audioContext.currentTime,t=this.audioContext.createOscillator();t.type="triangle",t.frequency.value=350,t.frequency.exponentialRampToValueAtTime(250,e+.1);const o=this.audioContext.createBiquadFilter();o.type="lowpass",o.frequency.value=800;const i=this.audioContext.createGain();i.gain.value=0,i.gain.setValueAtTime(0,e),i.gain.linearRampToValueAtTime(this.soundEffectsVolume*.5,e+.01),i.gain.linearRampToValueAtTime(0,e+.3),t.connect(o),o.connect(i),i.connect(this.audioContext.destination),t.start(e),t.stop(e+.3)}playCollisionSound(){if(!this.audioContext)return;const e=this.audioContext.currentTime,t=this.audioContext.sampleRate*.1,o=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=o.getChannelData(0);for(let c=0;c<t;c++)i[c]=(Math.random()*2-1)*Math.pow(1-c/t,2)*.5;const a=this.audioContext.createBufferSource();a.buffer=o;const s=this.audioContext.createBiquadFilter();s.type="bandpass",s.frequency.value=600,s.Q.value=1;const n=this.audioContext.createGain();n.gain.value=this.soundEffectsVolume*.4,n.gain.setValueAtTime(this.soundEffectsVolume*.4,e),n.gain.exponentialRampToValueAtTime(.001,e+.15),a.connect(s),s.connect(n),n.connect(this.audioContext.destination),a.start(e)}playMergeSound(){if(!this.audioContext)return;const e=this.audioContext.currentTime,t=this.audioContext.createOscillator();t.type="sine",t.frequency.value=80,t.frequency.exponentialRampToValueAtTime(40,e+.3);const o=this.audioContext.createDynamicsCompressor();o.threshold.value=-24,o.knee.value=30,o.ratio.value=12,o.attack.value=.003,o.release.value=.25;const i=this.audioContext.createBiquadFilter();i.type="lowpass",i.frequency.value=800,i.frequency.exponentialRampToValueAtTime(80,e+.4),i.Q.value=1;const a=this.audioContext.createGain();a.gain.value=0,a.gain.setValueAtTime(0,e),a.gain.linearRampToValueAtTime(this.soundEffectsVolume*.8,e+.02),a.gain.exponentialRampToValueAtTime(.001,e+.5),t.connect(i),i.connect(o),o.connect(a),a.connect(this.audioContext.destination);const s=this.audioContext.sampleRate*.2,n=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),c=n.getChannelData(0);for(let p=0;p<s;p++){const x=Math.pow(1-p/s,3);c[p]=(Math.random()*2-1)*x*.7}const r=this.audioContext.createBufferSource();r.buffer=n;const l=this.audioContext.createBiquadFilter();l.type="bandpass",l.frequency.value=250,l.Q.value=.7;const h=this.audioContext.createGain();h.gain.value=this.soundEffectsVolume*.25,h.gain.setValueAtTime(this.soundEffectsVolume*.25,e),h.gain.exponentialRampToValueAtTime(.001,e+.15),r.connect(l),l.connect(h),h.connect(this.audioContext.destination);const u=this.audioContext.createOscillator();u.type="triangle",u.frequency.value=180,u.frequency.exponentialRampToValueAtTime(120,e+.1);const m=this.audioContext.createGain();m.gain.value=0,m.gain.setValueAtTime(0,e),m.gain.linearRampToValueAtTime(this.soundEffectsVolume*.3,e+.01),m.gain.exponentialRampToValueAtTime(.001,e+.2),u.connect(m),m.connect(this.audioContext.destination),t.start(e),t.stop(e+.5),r.start(e),u.start(e),u.stop(e+.2)}playTone(e,t,o){if(!e)return;const i=e.createOscillator(),a=e.createGain();i.type="sine",i.frequency.value=t,a.gain.value=this.soundEffectsVolume,i.connect(a),a.connect(e.destination),i.start(),i.stop(e.currentTime+o)}playSound(e){try{const t=this.sounds[e];t&&typeof t=="function"&&t()}catch(t){console.error("Error playing sound:",t)}}createMusicControls(){}createVolumeControls(){const e=document.createElement("div");e.style.position="absolute",e.style.bottom="10px",e.style.left="10px",e.style.zIndex="1000",e.style.backgroundColor="rgba(0, 0, 0, 0.6)",e.style.padding="10px",e.style.borderRadius="4px",e.style.fontFamily="Arial, sans-serif",e.style.color="white",e.style.display="flex",e.style.flexDirection="column",e.style.gap="8px";const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.gap="8px";const o=document.createElement("label");o.textContent="🔊 Effects:",o.style.width="80px";const i=document.createElement("input");i.type="range",i.min="0",i.max="100",i.value=Math.round(this.soundEffectsVolume*100),i.style.width="100px",i.addEventListener("input",c=>{this.soundEffectsVolume=parseInt(c.target.value)/100}),t.appendChild(o),t.appendChild(i);const a=document.createElement("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="8px";const s=document.createElement("label");s.textContent="🎵 Music:",s.style.width="80px";const n=document.createElement("input");n.type="range",n.min="0",n.max="100",n.value=Math.round(this.musicVolume*100),n.style.width="100px",n.addEventListener("input",c=>{this.musicVolume=parseInt(c.target.value)/100,this.updateMusicVolume()}),a.appendChild(s),a.appendChild(n),e.appendChild(t),e.appendChild(a),document.body.appendChild(e)}updateMusicVolume(){this.musicNodes&&this.musicNodes.mainGainNode&&(this.musicNodes.mainGainNode.gain.value=this.musicVolume)}createBackgroundMusic(){this.musicNodes={bassOscillators:[],melodySynths:[],drumSounds:[],mainGainNode:null}}playBackgroundMusic(){if(this.musicPlaying)return;(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&this.audioContext.resume();const e=this.audioContext.createGain();e.gain.value=this.musicVolume,e.connect(this.audioContext.destination),this.musicNodes.mainGainNode=e,this.createSynthwaveBass(e),this.createSynthwaveMelody(e),this.createSynthwaveDrums(e),this.musicPlaying=!0,this.loopCheckInterval=setInterval(()=>{if(this.musicPlaying&&this.audioContext&&this.audioContext.state==="running"){const t=this.audioContext.currentTime;t>this.lastScheduledTime-60&&(this.createSynthwaveBass(e,t+1),this.createSynthwaveMelody(e,t+1),this.createSynthwaveDrums(e,t+1))}},3e4)}stopBackgroundMusic(){if(this.musicPlaying){if(this.loopCheckInterval&&(clearInterval(this.loopCheckInterval),this.loopCheckInterval=null),this.musicNodes&&this.musicNodes.mainGainNode){const e=this.audioContext.currentTime;this.musicNodes.mainGainNode.gain.setValueAtTime(this.musicNodes.mainGainNode.gain.value,e),this.musicNodes.mainGainNode.gain.linearRampToValueAtTime(0,e+1),setTimeout(()=>{this.musicNodes.bassOscillators.forEach(t=>{t&&t.stop&&t.stop()}),this.musicNodes.melodySynths.forEach(t=>{t&&t.stop&&t.stop()}),this.musicNodes.bassOscillators=[],this.musicNodes.melodySynths=[],this.musicNodes.drumSounds=[],this.musicNodes.mainGainNode=null},1e3)}this.musicPlaying=!1}}createSynthwaveBass(e,t=0){const o=this.audioContext.currentTime+t,i=[262,196,220,196],a=1,s=i.length*a,n=this.audioContext.createOscillator();n.type="sine";const c=this.audioContext.createBiquadFilter();c.type="lowpass",c.frequency.value=500;const r=this.audioContext.createGain();n.connect(c),c.connect(r),r.connect(e);const l=1e3;for(let h=0;h<l;h++)for(let u=0;u<i.length;u++){const m=o+h*s+u*a;n.frequency.setValueAtTime(i[u],m),r.gain.setValueAtTime(0,m),r.gain.linearRampToValueAtTime(.3,m+.1),r.gain.linearRampToValueAtTime(.2,m+a*.9),this.lastScheduledTime=Math.max(this.lastScheduledTime||0,m+a)}n.start(),this.musicNodes.bassOscillators.push(n)}createSynthwaveMelody(e,t=0){const o=this.audioContext.currentTime+t,i=[523,587,659,698,784],a=[1,1,2,1.5,1.5];this.scheduleMelodyPattern(i,a,100,e,o)}scheduleMelodyPattern(e,t,o,i,a){const s=60/o;let n=a;const c=200;for(let r=0;r<c;r++){r>0&&(n+=s*2);const l=[0,1,2,1,4,2,3,2];for(let h=0;h<l.length;h++){if(Math.random()>.2){const u=e[l[h]],m=t[h%t.length]*s;this.playMelodyNote(u,n,m,i)}n+=t[h%t.length]*s,this.lastScheduledTime=Math.max(this.lastScheduledTime||0,n)}}}playMelodyNote(e,t,o,i){const a=this.audioContext.createOscillator();a.type="sine",a.frequency.value=e;const s=this.audioContext.createBiquadFilter();s.type="lowpass",s.frequency.value=1500;const n=this.audioContext.createGain();n.gain.value=0,a.connect(s),s.connect(n),n.connect(i),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.2,t+.1),n.gain.linearRampToValueAtTime(.15,t+o*.6),n.gain.linearRampToValueAtTime(0,t+o),a.start(t),a.stop(t+o),this.musicNodes.melodySynths.push(a)}createSynthwaveDrums(e,t=0){const a=this.audioContext.currentTime+t;for(let s=0;s<100;s++){const n=a+s*.6*4;this.playKickDrum(n,e),s%2===0&&this.playHiHat(n+.6*2,e,.1),this.lastScheduledTime=Math.max(this.lastScheduledTime||0,n+.6*4)}}playKickDrum(e,t){if(!this.audioContext)return;const o=this.audioContext.createOscillator();o.type="sine";const i=this.audioContext.createGain();i.gain.value=0,o.connect(i),i.connect(t),o.frequency.setValueAtTime(80,e),o.frequency.exponentialRampToValueAtTime(40,e+.1),i.gain.setValueAtTime(0,e),i.gain.linearRampToValueAtTime(.2,e+.02),i.gain.exponentialRampToValueAtTime(.01,e+.3),o.start(e),o.stop(e+.3),this.musicNodes.drumSounds.push(o)}playHiHat(e,t,o=.1){if(!this.audioContext)return;const i=this.audioContext.createOscillator();i.type="sine",i.frequency.value=8e3;const a=this.audioContext.createBiquadFilter();a.type="highpass",a.frequency.value=7e3;const s=this.audioContext.createGain();s.gain.value=0,i.connect(a),a.connect(s),s.connect(t),s.gain.setValueAtTime(0,e),s.gain.linearRampToValueAtTime(o,e+.001),s.gain.exponentialRampToValueAtTime(.001,e+.05),i.start(e),i.stop(e+.05),this.musicNodes.drumSounds.push(i)}playSnare(e,t,o=.1){}}const X=new ht;class dt{constructor(){this.orangeTexture=null,this.strawberryTexture=null,this.watermelonTexture=null,this.grapeTexture=null,this.grapeAltTexture=null,this.appleTexture=null,this.pearTexture=null,this.peachTexture=null,this.pumpkinTexture=null,this.melonTexture=null,this.paperTexture=null,this.createProceduralTextures(),this.createPaperTexture()}createPaperTexture(){const t=document.createElement("canvas");t.width=512,t.height=512;const o=t.getContext("2d");o.fillStyle="#C49A6C",o.fillRect(0,0,512,512);const i=o.getImageData(0,0,512,512),a=i.data;for(let r=0;r<a.length;r+=4){const l=Math.random()*20-10;a[r]=Math.max(0,Math.min(255,a[r]+l)),a[r+1]=Math.max(0,Math.min(255,a[r+1]+l*.9)),a[r+2]=Math.max(0,Math.min(255,a[r+2]+l*.8))}o.putImageData(i,0,0);const s=o.createRadialGradient(512/2,512/2,512/2*.7,512/2,512/2,512/2);s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(1,"rgba(0, 0, 0, 0.2)"),o.fillStyle=s,o.fillRect(0,0,512,512);for(let r=0;r<10;r++){const l=Math.random()*512,h=Math.random()*512,u=l+(Math.random()*200-100),m=h+(Math.random()*200-100),p=1+Math.random()*3;o.beginPath(),o.moveTo(l,h),o.lineTo(u,m),o.strokeStyle=`rgba(90, 60, 40, ${.05+Math.random()*.1})`,o.lineWidth=p,o.stroke()}for(let r=0;r<20;r++){const l=Math.random()*512,h=Math.random()*512,u=5+Math.random()*20,m=o.createRadialGradient(l,h,0,l,h,u),p=.03+Math.random()*.08;Math.random()<.7?(m.addColorStop(0,`rgba(80, 50, 30, ${p})`),m.addColorStop(1,"rgba(80, 50, 30, 0)")):(m.addColorStop(0,`rgba(190, 160, 100, ${p})`),m.addColorStop(1,"rgba(190, 160, 100, 0)")),o.fillStyle=m,o.beginPath(),o.arc(l,h,u,0,Math.PI*2),o.fill()}for(let r=1;r<3;r++){const l=512*(r/3);o.beginPath(),o.moveTo(l,0),o.lineTo(l,512),o.strokeStyle="rgba(90, 60, 40, 0.15)",o.lineWidth=3,o.stroke(),o.beginPath(),o.moveTo(l+3,0),o.lineTo(l+3,512),o.strokeStyle="rgba(255, 255, 255, 0.1)",o.lineWidth=2,o.stroke()}const n=512*.15,c=512*.85;o.beginPath(),o.moveTo(0,n),o.lineTo(512,n),o.strokeStyle="rgba(90, 60, 40, 0.2)",o.lineWidth=4,o.stroke(),o.beginPath(),o.moveTo(0,c),o.lineTo(512,c),o.strokeStyle="rgba(90, 60, 40, 0.2)",o.lineWidth=4,o.stroke(),this.paperTexture=new V(t),this.paperTexture.wrapS=T,this.paperTexture.wrapT=T}createProceduralTextures(){const t=document.createElement("canvas");t.width=512,t.height=512;const o=t.getContext("2d"),i=o.createRadialGradient(512/2,512/2,0,512/2,512/2,512/2);i.addColorStop(0,"#FFAA20"),i.addColorStop(.7,"#FF8C00"),i.addColorStop(1,"#E67300"),o.fillStyle=i,o.fillRect(0,0,512,512);const a=o.getImageData(0,0,512,512),s=a.data;for(let d=0;d<s.length;d+=4){const y=Math.random()*15-5;s[d]=Math.max(0,Math.min(255,s[d]+y)),s[d+1]=Math.max(0,Math.min(255,s[d+1]+y)),s[d+2]=Math.max(0,Math.min(255,s[d+2]+y))}o.putImageData(a,0,0),this.orangeTexture=new V(t),this.orangeTexture.wrapS=T,this.orangeTexture.wrapT=T;const n=512,c=document.createElement("canvas");c.width=n,c.height=n;const r=c.getContext("2d"),l=r.createRadialGradient(n/2,n/2,0,n/2,n/2,n/2);l.addColorStop(0,"#FF4070"),l.addColorStop(.5,"#FF2052"),l.addColorStop(.85,"#E01040"),l.addColorStop(1,"#C00030"),r.fillStyle=l,r.fillRect(0,0,n,n);const h=r.getImageData(0,0,n,n),u=h.data;for(let d=0;d<u.length;d+=4){const y=Math.random()*20-7;u[d]=Math.max(0,Math.min(255,u[d]+y)),u[d+1]=Math.max(0,Math.min(255,u[d+1]+y*.6)),u[d+2]=Math.max(0,Math.min(255,u[d+2]+y*.4))}r.putImageData(h,0,0),this.strawberryTexture=new V(c),this.strawberryTexture.wrapS=T,this.strawberryTexture.wrapT=T;const m=512,p=document.createElement("canvas");p.width=m,p.height=m;const x=p.getContext("2d"),P="#006400";x.fillStyle=P,x.fillRect(0,0,m,m);for(let d=0;d<m;d++)for(let y=0;y<m;y++){const C=y-m/2,I=d-m/2,U=Math.atan2(I,C);if(Math.sqrt(C*C+I*I)/(m/2)>1)continue;(Math.sin(U*8)+1)/2>1-.5?(x.fillStyle="#32CD32",x.fillRect(y,d,1,1)):(x.fillStyle="#004200",x.fillRect(y,d,1,1))}this.watermelonTexture=new V(p),this.watermelonTexture.wrapS=T,this.watermelonTexture.wrapT=T;const b=512,A=document.createElement("canvas");A.width=b,A.height=b;const Z=A.getContext("2d"),ee=Z.createRadialGradient(b/2,b/2,0,b/2,b/2,b/2);ee.addColorStop(0,"#9040F0"),ee.addColorStop(.5,"#8030E0"),ee.addColorStop(1,"#6020C0"),Z.fillStyle=ee,Z.fillRect(0,0,b,b);const le=Z.getImageData(0,0,b,b),q=le.data;for(let d=0;d<q.length;d+=4){const y=(Math.random()-.5)*30;q[d]=Math.max(0,Math.min(255,q[d]+y)),q[d+1]=Math.max(0,Math.min(255,q[d+1]+y)),q[d+2]=Math.max(0,Math.min(255,q[d+2]+y))}Z.putImageData(le,0,0),this.grapeTexture=new V(A),this.grapeTexture.wrapS=T,this.grapeTexture.wrapT=T;const ue=document.createElement("canvas");ue.width=b,ue.height=b;const S=ue.getContext("2d");S.drawImage(A,0,0);const W=b*.5,we=b*.5,z=b*.035,Fe=b*.08,he=we-b*.03,Ee=W-Fe,Pe=W+Fe;S.fillStyle="black",S.beginPath(),S.arc(Ee,he,z,0,Math.PI*2),S.arc(Pe,he,z,0,Math.PI*2),S.fill(),S.fillStyle="white",S.beginPath(),S.arc(Ee-z*.2,he-z*.2,z*.5,0,Math.PI*2),S.arc(Pe-z*.2,he-z*.2,z*.5,0,Math.PI*2),S.fill(),S.fillStyle="rgba(0,0,0,0.8)";const Ve=z*.8,Ne=z*1.2,Re=we+b*.01;S.beginPath(),S.ellipse(W,Re,Ve,Ne,0,0,Math.PI*2),S.fill(),S.strokeStyle="rgba(0,0,0,0.6)",S.lineWidth=z*.3,S.lineCap="round";const te=we+b*.06,$=b*.04;S.beginPath(),S.moveTo(W-$*1.2,te),S.quadraticCurveTo(W-$*.6,te+$*.3,W-$*.3,te),S.stroke(),S.beginPath(),S.moveTo(W+$*1.2,te),S.quadraticCurveTo(W+$*.6,te+$*.3,W+$*.3,te),S.stroke(),this.grapeAltTexture=new V(ue),this.grapeAltTexture.center.set(.5,.5),this.grapeAltTexture.rotation=Math.PI,this.grapeAltTexture.wrapS=T,this.grapeAltTexture.wrapT=T;const k=512,de=document.createElement("canvas");de.width=k,de.height=k;const B=de.getContext("2d");B.fillStyle="#FF3300",B.fillRect(0,0,k,k);const se=B.createRadialGradient(k*.5,k*.5,0,k*.5,k*.5,k*.8);se.addColorStop(0,"rgba(255, 99, 71, 0.95)"),se.addColorStop(.3,"rgba(255, 69, 0, 0.9)"),se.addColorStop(.6,"rgba(255, 45, 0, 0.85)"),se.addColorStop(1,"rgba(215, 40, 0, 0.8)"),B.fillStyle=se,B.fillRect(0,0,k,k);for(let d=0;d<3e3;d++){const y=Math.random()*k,C=Math.random()*k,I=.2+Math.random()*.4;B.beginPath(),B.arc(y,C,I,0,Math.PI*2);const U=.01+Math.random()*.02;Math.random()>.7?B.fillStyle=`rgba(255, 160, 120, ${U})`:B.fillStyle=`rgba(255, 80, 40, ${U})`,B.fill()}this.peachTexture=new V(de),this.peachTexture.wrapS=T,this.peachTexture.wrapT=T;const ie=512,me=document.createElement("canvas");me.width=ie,me.height=ie;const oe=me.getContext("2d");oe.fillStyle="#FF0000",oe.fillRect(0,0,ie,ie);for(let d=0;d<1e3;d++){const y=Math.random()*ie,C=Math.random()*ie,I=5+Math.random()*10;oe.beginPath(),oe.arc(y,C,I,0,Math.PI*2),oe.fillStyle=`rgba(200, 0, 0, ${Math.random()*.3})`,oe.fill()}this.appleTexture=new V(me),this.appleTexture.wrapS=T,this.appleTexture.wrapT=T;const ae=512,pe=document.createElement("canvas");pe.width=ae,pe.height=ae;const ne=pe.getContext("2d");ne.fillStyle="#FFD700",ne.fillRect(0,0,ae,ae);for(let d=0;d<2e3;d++){const y=Math.random()*ae,C=Math.random()*ae;ne.beginPath(),ne.arc(y,C,1,0,Math.PI*2),ne.fillStyle=`rgba(139, 69, 19, ${Math.random()*.3})`,ne.fill()}this.pearTexture=new V(pe),this.pearTexture.wrapS=T,this.pearTexture.wrapT=T;const H=512,ge=document.createElement("canvas");ge.width=H,ge.height=H;const D=ge.getContext("2d");D.fillStyle="#FF7518",D.fillRect(0,0,H,H);for(let d=0;d<8;d++){const y=H/8+d*H/8;D.beginPath(),D.moveTo(y,0),D.lineTo(y,H),D.lineWidth=10,D.strokeStyle="#E86100",D.stroke()}for(let d=0;d<3e3;d++){const y=Math.random()*H,C=Math.random()*H,I=1+Math.random()*2;D.beginPath(),D.arc(y,C,I,0,Math.PI*2),D.fillStyle=`rgba(255, 138, 36, ${Math.random()*.3})`,D.fill()}this.pumpkinTexture=new V(ge),this.pumpkinTexture.wrapS=T,this.pumpkinTexture.wrapT=T;const _=512,ye=document.createElement("canvas");ye.width=_,ye.height=_;const v=ye.getContext("2d"),ze="#F4E5C3";v.fillStyle=ze,v.fillRect(0,0,_,_);const Ie=v.getImageData(0,0,_,_),j=Ie.data;for(let d=0;d<j.length;d+=4){const y=Math.random()*15-7;j[d]=Math.max(0,Math.min(255,j[d]+y)),j[d+1]=Math.max(0,Math.min(255,j[d+1]+y*.8)),j[d+2]=Math.max(0,Math.min(255,j[d+2]+y*.6))}v.putImageData(Ie,0,0);for(let d=0;d<2e3;d++){const y=Math.random()*_,C=Math.random()*_,I=10+Math.random()*20,U=Math.random()*Math.PI*2;v.beginPath(),v.moveTo(y,C),v.lineTo(y+Math.cos(U)*I,C+Math.sin(U)*I),v.lineWidth=1+Math.random()*2,v.strokeStyle="rgba(255, 245, 220, 0.4)",v.stroke(),v.beginPath(),v.moveTo(y+1,C+1),v.lineTo(y+Math.cos(U)*I+1,C+Math.sin(U)*I+1),v.strokeStyle="rgba(150, 140, 110, 0.4)",v.stroke()}this.melonTexture=new V(ye),this.melonTexture.wrapS=T,this.melonTexture.wrapT=T}loadTextureFromDataUrl(e){return new Be().load(e)}}class mt{constructor(){this.currentScore=0,this.highScore=this.loadHighScore(),this.scoreElement=document.getElementById("score"),this.highScoreElement=null,this.initHighScoreDisplay()}initHighScoreDisplay(){this.highScoreElement=document.getElementById("high-score"),this.highScoreElement||(this.highScoreElement=document.createElement("div"),this.highScoreElement.id="high-score",this.highScoreElement.style.position="absolute",this.highScoreElement.style.top="50px",this.highScoreElement.style.left="20px",this.highScoreElement.style.color="white",this.highScoreElement.style.fontFamily="Arial, sans-serif",this.highScoreElement.style.fontSize="18px",document.body.appendChild(this.highScoreElement)),this.updateHighScoreDisplay()}loadHighScore(){const e=localStorage.getItem("suikaHighScore");return e?parseInt(e):0}saveHighScore(e){localStorage.setItem("suikaHighScore",e.toString())}updateScore(e){return this.currentScore=e,this.updateScoreDisplay(),e>this.highScore?(this.highScore=e,this.saveHighScore(e),this.updateHighScoreDisplay(),!0):!1}addPoints(e){return this.updateScore(this.currentScore+e)}getHighScore(){return this.highScore}getCurrentScore(){return this.currentScore}setHighScore(e){this.highScore=e,this.saveHighScore(e),this.updateHighScoreDisplay()}resetCurrentScore(){this.updateScore(0)}updateScoreDisplay(){this.scoreElement&&(this.scoreElement.textContent=`Score: ${this.currentScore}`)}updateHighScoreDisplay(){this.highScoreElement&&(this.highScoreElement.textContent=`High Score: ${this.highScore}`)}clearHighScore(){this.highScore=0,this.saveHighScore(0),this.updateHighScoreDisplay()}}class pt{constructor(e){this.scene=e,this.particles=new Map,this.starGeometry=this.createStarGeometry()}createStarGeometry(){const e=[];for(let s=0;s<5*2;s++){const n=s%2===0?.15:.05,c=s/(5*2)*Math.PI*2;e.push(new xe(Math.cos(c)*n,Math.sin(c)*n))}const a=new re(e);return new ce(a)}createParticleSystem(e,t){const i=new R;for(let a=0;a<20;a++){const s=new w(this.starGeometry,new ve({color:t,transparent:!0,opacity:0,side:J}));s.rotation.z=Math.random()*Math.PI*2,s.visible=!1,i.add(s)}this.scene.add(i),this.particles.set(e,{group:i,lastPosition:e.position.clone(),nextParticleIndex:0,updateCounter:0})}removeParticleSystem(e){const t=this.particles.get(e);t&&(this.scene.remove(t.group),this.particles.delete(e))}update(){this.particles.forEach((e,t)=>{if(t.position.distanceTo(e.lastPosition)>.05){if(e.updateCounter++,e.updateCounter%2===0){const i=e.group.children[e.nextParticleIndex];i.position.copy(t.position),i.material.opacity=.8,i.scale.set(1,1,1),i.visible=!0,e.nextParticleIndex=(e.nextParticleIndex+1)%e.group.children.length}e.lastPosition.copy(t.position)}e.group.children.forEach(i=>{i.visible&&(i.material.opacity*=.95,i.scale.multiplyScalar(.95),i.material.opacity<.1&&(i.visible=!1))})})}}class gt{constructor(e,t,o,i){this.world=e,this.fruitMaterial=t,this.textureManager=o,this.scene=i,this.particleSystem=new pt(i)}createFruitGeometry(e){switch(e.shape){case"cherry":{const t=new R,o=new w(new N(e.radius),new E({color:e.color,shininess:100,specular:4473924}));t.add(o);const i=new w(new Y(.05,.05,e.radius*1.5,8),new E({color:e.stemColor}));return i.position.y=e.radius*.8,i.rotation.x=Math.PI/6,t.add(i),t}case"strawberry":{const t=new R,o=new N(e.radius,32,32),i=o.attributes.position.array;for(let r=0;r<i.length;r+=3){const l=i[r+1];if(l<0){const p=.8+l/e.radius*.2;i[r]*=p,i[r+2]*=p}l>e.radius*.5&&(i[r+1]*=.9);const h=i[r],u=i[r+2],m=Math.sqrt(h*h+u*u)/e.radius;if(m>.5&&m<.95){const p=Math.atan2(u,h),x=.03*Math.sin(p*38)*Math.sin(l*40);i[r]+=i[r]*x,i[r+2]+=i[r+2]*x}}o.attributes.position.needsUpdate=!0,o.computeVertexNormals();const a=new L({color:e.color,roughness:.7,metalness:.1,map:this.textureManager.strawberryTexture,bumpMap:this.textureManager.strawberryTexture,bumpScale:.04,normalMap:this.textureManager.strawberryTexture,normalScale:new xe(.05,.05),envMapIntensity:.8}),s=new w(o,a);t.add(s);const n=new R;for(let r=0;r<5;r++){const l=new re,h=e.radius*(.25+Math.random()*.1),u=e.radius*(.3+Math.random()*.1);l.moveTo(0,0),l.quadraticCurveTo(h/2,u/2,h,0),l.quadraticCurveTo(h/2,-u/6,0,0);const m=new ce(l),p=new w(m,new E({color:e.leafColor,shininess:10,side:J}));p.rotation.x=Math.PI/2-Math.random()*.3,p.rotation.z=r/5*Math.PI*2,n.add(p)}n.position.y=e.radius*.9,t.add(n);const c=new w(new Y(e.radius*.05,e.radius*.08,e.radius*.2,8),new E({color:8016432,shininess:5}));return c.position.y=e.radius*.8,t.add(c),t}case"apple":{const t=new R,o=new w(new N(e.radius,32,32),new L({color:e.color,roughness:.7,metalness:.1,map:this.textureManager.appleTexture,bumpMap:this.textureManager.appleTexture,bumpScale:.02,normalMap:this.textureManager.appleTexture,normalScale:new xe(.04,.04)}));t.add(o);const i=new Y(e.radius*.12,e.radius*.12,e.radius*.1,8),a=new w(i,new L({color:5909760,roughness:.9,metalness:0}));a.position.y=e.radius*.92,t.add(a);const s=new Y(e.radius*.03,e.radius*.05,e.radius*.3,8),n=s.attributes.position.array;for(let p=0;p<n.length;p+=3){const x=n[p+1];x>0&&(n[p]+=e.radius*.05*(x/(e.radius*.3)))}s.attributes.position.needsUpdate=!0,s.computeVertexNormals();const c=new w(s,new L({color:e.stemColor||4878371,roughness:.9,metalness:.05}));c.position.y=e.radius*1.05,c.rotation.x=Math.PI/12,c.rotation.z=Math.PI/8,t.add(c);const r=new re,l=e.radius*.25,h=e.radius*.3;r.moveTo(0,0),r.quadraticCurveTo(l/3,h/2,l,0),r.quadraticCurveTo(l/3,-h/4,0,0);const u=new ce(r),m=new w(u,new L({color:e.stemColor||4878371,roughness:.8,metalness:.05,side:J}));return m.position.set(e.radius*.05,e.radius*.9,e.radius*.05),m.rotation.set(Math.PI/3,0,Math.PI/8),t.add(m),t}case"pear":{const t=new R,o=new N(e.radius,32,32),i=o.attributes.position.array;for(let c=0;c<i.length;c+=3){const r=i[c+1];if(r<0){const l=1+Math.abs(r/e.radius)*.3;i[c]*=l,i[c+2]*=l}else if(r>0){const l=1-r/e.radius*.3;i[c]*=l,i[c+2]*=l}}o.attributes.position.needsUpdate=!0;const a=new w(o,new E({color:e.color,shininess:30,map:this.textureManager.pearTexture,bumpMap:this.textureManager.pearTexture,bumpScale:.01}));t.add(a);const s=new Y(e.radius*.05,e.radius*.05,e.radius*.3,8),n=new w(s,new E({color:8011008}));return n.position.y=e.radius*1.1,t.add(n),t}case"peach":{const t=new R,o=new N(e.radius,32,32),i=o.attributes.position.array;for(let x=0;x<i.length;x+=3){const P=i[x],b=i[x+1],A=i[x+2];if(i[x]*=1.05,i[x+2]*=1.05,A>0&&Math.abs(P)<e.radius*.2){const ee=Math.exp(-Math.pow(P/(e.radius*.15),2)),le=1-Math.pow(b/(e.radius*1.1),2),q=.1*ee*Math.max(0,le);i[x+2]*=1-q}}o.attributes.position.needsUpdate=!0,o.computeVertexNormals();const a=new L({map:this.textureManager.peachTexture,roughness:.8,metalness:0}),s=new w(o,a);s.rotation.x=Math.PI*.5,t.add(s);const n=new Y(e.radius*.02,e.radius*.04,e.radius*.15,8),c=n.attributes.position.array;for(let x=0;x<c.length;x+=3){const P=c[x+1];P>0&&(c[x]+=e.radius*.03*(P/(e.radius*.15)))}n.attributes.position.needsUpdate=!0,n.computeVertexNormals();const r=new w(n,new L({color:5911296,roughness:.9,metalness:0}));r.position.set(0,e.radius*.85,0),r.rotation.x=Math.PI/12,r.rotation.x+=Math.PI*.5,t.add(r);const l=new re,h=e.radius*.2,u=e.radius*.25;l.moveTo(0,0),l.quadraticCurveTo(h/3,u/2,h,0),l.quadraticCurveTo(h/3,-u/4,0,0);const m=new ce(l),p=new w(m,new L({color:5081642,roughness:.8,metalness:0,side:J}));return p.position.set(e.radius*.05,e.radius*.85,e.radius*.05),p.rotation.set(Math.PI/3,0,Math.PI/6),p.rotation.x+=Math.PI*.5,t.add(p),t}case"pumpkin":{const t=new R,o=16,i=e.radius,a=new N(i,o,o),s=new E({color:e.color,shininess:5,map:this.textureManager.pumpkinTexture,bumpMap:this.textureManager.pumpkinTexture,bumpScale:.05}),n=new w(a,s),c=a.attributes.position;for(let u=0;u<c.count;u++){const m=c.getX(u);c.getY(u);const p=c.getZ(u),x=Math.atan2(p,m),P=Math.sin(x*8)*.08*i,b=m*(1+P),A=p*(1+P);c.setX(u,b),c.setZ(u,A)}c.needsUpdate=!0,a.computeVertexNormals(),t.add(n);const r=new Y(.1,.15,i*.4,8),l=new E({color:e.stemColor,shininess:5}),h=new w(r,l);return h.position.y=i*.9,h.rotation.x=Math.PI*.05,h.rotation.z=Math.PI*.1,t.add(h),t}case"melon":{const t=new N(e.radius,32,32),o=new E({color:e.color,shininess:40,map:this.textureManager.melonTexture,bumpMap:this.textureManager.melonTexture,bumpScale:.02});return new w(t,o)}case"watermelon":{const t=new R,o=new N(e.radius,32,32),i=o.attributes.position.array;for(let n=0;n<i.length;n+=3){i[n]*=1.02,i[n+2]*=1.02;const c=i[n],r=i[n+2],h=(Math.random()-.5)*.005,u=i[n+1];Math.abs(u/e.radius)<.7&&(i[n]+=c*h,i[n+2]+=r*h)}o.attributes.position.needsUpdate=!0,o.computeVertexNormals();const a=new L({map:this.textureManager.watermelonTexture,roughness:.5,metalness:0,bumpScale:.01}),s=new w(o,a);return t.add(s),t}case"orange":{const t=new R,o=new N(e.radius,32,32),i=o.attributes.position.array;for(let u=0;u<i.length;u+=3){const m=i[u],p=i[u+1],x=i[u+2],P=Math.atan2(x,m),b=.02*Math.sin(P*10)*Math.sin(p*12);i[u]+=i[u]*b,i[u+1]+=i[u+1]*b,i[u+2]+=i[u+2]*b,Math.abs(p/e.radius)>.8&&(i[u+1]*=.95)}o.attributes.position.needsUpdate=!0,o.computeVertexNormals();const a=new E({color:e.color,shininess:80,specular:8921600,map:this.textureManager.orangeTexture,bumpMap:this.textureManager.orangeTexture,bumpScale:e.bumpScale||.03,emissive:2228224,emissiveIntensity:.05}),s=new w(o,a);t.add(s);const n=new R,c=new w(new Y(e.radius*.05,e.radius*.08,e.radius*.06,8),new E({color:8934690}));n.add(c);const r=new re,l=e.radius*.15;r.moveTo(0,0),r.quadraticCurveTo(l*.5,l,l,0),r.quadraticCurveTo(l*.5,-l*.3,0,0);const h=new w(new ce(r),new E({color:2972199,side:J}));return h.rotation.set(Math.PI/2-.2,0,0),h.position.set(e.radius*.05,e.radius*.06,0),n.add(h),n.position.y=e.radius*.9,n.rotation.x=Math.PI*.1,t.add(n),t}case"grape":{const t=new N(e.radius,32,32),o=Math.random()<.001;if(o){const a=t.attributes.uv,s=t.attributes.position;for(let n=0;n<a.count;n++){const c=s.getX(n),r=s.getY(n),l=s.getZ(n),h=Math.acos(r/e.radius),u=.5+Math.atan2(c,l)/(2*Math.PI),m=1-h/Math.PI;a.setXY(n,u,m)}a.needsUpdate=!0}const i=new E({color:e.color,shininess:120,transparent:!1,opacity:1,map:o?this.textureManager.grapeAltTexture:this.textureManager.grapeTexture,bumpMap:o?this.textureManager.grapeAltTexture:this.textureManager.grapeTexture,bumpScale:.01});return new w(t,i)}default:{const t=new N(e.radius,32,32),o=new E({color:e.color});return new w(t,o)}}}createFruitBody(e,t={x:0,y:0},o=!1){const i=e.radius;let a,s;return e.shape==="watermelon"?a=new Me(i*1.02):a=new Me(i),s=new O({mass:1,shape:a,position:new f(t.x,t.y,0),material:this.fruitMaterial,linearDamping:.1,angularDamping:.3,collisionFilterGroup:o?0:1,collisionFilterMask:o?0:1}),s.linearFactor=new f(1,1,0),s.angularFactor=new f(0,0,1),this.world.addBody(s),s.addEventListener("collide",n=>{if(!o&&window.audioManager){const c=n.contact.getImpactVelocityAlongNormal(),r=Math.min(Math.abs(c)/10,1);if(r>.1){const l=.8+Math.random()*.4;window.audioManager.playSound("hit",l,r)}}}),s}createFruit(e,t,o=!1){try{const i=this.createFruitGeometry(e);i.position.copy(t);const a=this.createFruitBody(e,t,o);return o&&i.traverse(n=>{n.isMesh&&n.material&&(n.material=n.material.clone(),n.material.transparent=!0,n.material.opacity=.7)}),this.scene&&this.scene.add(i),this.particleSystem.createParticleSystem(i,e.color),{mesh:i,body:a,type:e,dropTime:null}}catch(i){return console.error("Error in FruitFactory.createFruit:",i),{mesh:{position:new Q(t.x,t.y,0),quaternion:new Ce},body:{position:new f(t.x,t.y,0),quaternion:new fe,velocity:new f(0,0,0),angularVelocity:new f(0,0,0),type:0,addEventListener:()=>{}},type:e}}}update(){this.particleSystem.update()}}class yt{constructor(){this.gameUrl="https://www.ainosuika.com",this.defaultMessage="I scored {score} in Ai-No-Suika Game! Can you beat my score?",this.previewImageUrl="https://www.ainosuika.com/main/preview.png"}createSocialButtons(e){console.log("Creating social buttons for score:",e);const t=document.createElement("div");t.className="social-share-container",t.style.display="flex",t.style.flexDirection="row",t.style.justifyContent="center",t.style.gap="10px",t.style.marginTop="15px",t.style.width="100%";const o=this.defaultMessage.replace("{score}",e),i=this.createShareButton("X","#000000",()=>this.shareOnTwitter(o,e)),a=this.createShareButton("👍 Facebook","#4267B2",()=>this.shareOnFacebook(e)),s=this.createShareButton("💬 WhatsApp","#25D366",()=>this.shareOnWhatsApp(o)),n=this.createShareButton("📋 Share","#7289DA",()=>this.copyShareText(o,e));return t.appendChild(i),t.appendChild(a),t.appendChild(s),t.appendChild(n),console.log("Social buttons created, count:",t.childNodes.length),t}createShareButton(e,t,o){const i=document.createElement("button");return i.innerText=e,i.style.padding="8px 15px",i.style.margin="5px",i.style.borderRadius="5px",i.style.border="none",i.style.backgroundColor=t,i.style.color="white",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.display="inline-block",i.style.minWidth="100px",i.addEventListener("click",o),i}shareOnTwitter(e,t){this.updateMetaTags(t);const o=`${this.previewImageUrl}?v=${Date.now()}`;this.updateMetaTag("twitter:image",o);const i=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}&url=${encodeURIComponent(this.gameUrl)}&hashtags=AiNoSuikaGame,VibeJam`;window.open(i,"_blank")}shareOnFacebook(e){this.updateMetaTags(e);const t=`I just scored ${e} points in Ai-No-Suika Game! Think you can beat my score? Challenge accepted? #AiNoSuikaGame #VibeJam`,o=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(this.gameUrl)}&quote=${encodeURIComponent(t)}`;window.open(o,"_blank")}shareOnWhatsApp(e){const t=`https://wa.me/?text=${encodeURIComponent(e+" "+this.gameUrl)}`;window.open(t,"_blank")}copyShareText(e,t){const o=`I just scored ${t} points in Ai-No-Suika Game! Think you can beat my score? Challenge accepted! Play at ${this.gameUrl} #AiNoSuikaGame #VibeJam`,i=document.createElement("textarea");i.value=o,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),alert("Share text copied to clipboard! Now you can paste it anywhere.")}updateMetaTags(e){const t=this.defaultMessage.replace("{score}",e);this.updateMetaTag("og:title","Ai-No-Suika Game - Score: "+e),this.updateMetaTag("og:description",t),this.updateMetaTag("twitter:title","Ai-No-Suika Game - Score: "+e),this.updateMetaTag("twitter:description",t),this.updateMetaTag("og:image",this.previewImageUrl),this.updateMetaTag("twitter:image",this.previewImageUrl)}updateMetaTag(e,t){let o=document.querySelector(`meta[property="${e}"]`)||document.querySelector(`meta[name="${e}"]`);o?o.setAttribute("content",t):(o=document.createElement("meta"),o.setAttribute(e.includes(":")?"property":"name",e),o.setAttribute("content",t),document.head.appendChild(o))}}const ft=new yt;class xt{constructor(e){this.scene=e,this.comboCount=0,this.lastComboTime=0,this.comboTimeout=1500,this.comboText=null,this.comboParticles=new R,this.scene.add(this.comboParticles);const t=document.createElement("canvas"),o=t.getContext("2d");t.width=512,t.height=128,this.textCanvas=t,this.textContext=o;const i=new V(t),a=new Le({map:i,transparent:!0});this.comboText=new Oe(a),this.comboText.scale.set(4,1,1),this.comboText.visible=!1,this.scene.add(this.comboText)}getComboMultiplier(){return this.comboCount<2?1:Math.min(1+(this.comboCount-1)*.5,5)}getComboMultiplierText(){const e=this.getComboMultiplier();return e>1?`${e.toFixed(1)}x`:""}incrementCombo(e,t){const o=Date.now();return o-this.lastComboTime>this.comboTimeout&&(this.comboCount=0),this.comboCount++,this.lastComboTime=o,this.updateComboText(e),this.createComboParticles(e,t),this.getComboMultiplier()}updateComboText(e){if(this.comboCount<2){this.comboText.visible=!1;return}const t=this.textContext;t.clearRect(0,0,this.textCanvas.width,this.textCanvas.height),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,this.textCanvas.width,this.textCanvas.height),t.fillStyle=this.getComboColor(),t.strokeStyle="white",t.lineWidth=4,t.font="bold 64px Arial",t.textAlign="center",t.textBaseline="middle";const o=`${this.comboCount}x COMBO!`,i=this.textCanvas.width/2,a=this.textCanvas.height/2;t.strokeText(o,i,a),t.fillText(o,i,a),this.comboText.material.map.needsUpdate=!0,this.comboText.position.set(0,g-1,0),this.comboText.visible=!0}createComboParticles(e,t){const o=Math.min(this.comboCount*5,20),i=typeof t=="number"?new qe(t):t;for(let a=0;a<o;a++){const s=new w(new We(.1,8),new ve({color:i,transparent:!0,opacity:1}));s.position.copy(e);const n=Math.random()*Math.PI*2,c=.1+Math.random()*.2;s.userData.velocity=new Q(Math.cos(n)*c,Math.sin(n)*c,0),this.comboParticles.add(s)}}getComboColor(){return this.comboCount>=8?"#FF0000":this.comboCount>=6?"#FF6600":this.comboCount>=4?"#FFCC00":"#FFFFFF"}update(){this.comboText.visible&&Date.now()-this.lastComboTime>this.comboTimeout&&(this.comboText.visible=!1,this.comboCount=0);for(let e=this.comboParticles.children.length-1;e>=0;e--){const t=this.comboParticles.children[e];t.position.add(t.userData.velocity),t.material.opacity*=.95,t.material.opacity<.1&&(t.geometry.dispose(),t.material.dispose(),this.comboParticles.remove(t))}}dispose(){this.comboText&&(this.comboText.material.map.dispose(),this.comboText.material.dispose(),this.scene.remove(this.comboText)),this.comboParticles.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()}),this.scene.remove(this.comboParticles)}}class wt{constructor(){this.storageKey="aiNoSuikaLeaderboard",this.maxEntries=10,this.scores=this.loadScores()}loadScores(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}saveScores(){localStorage.setItem(this.storageKey,JSON.stringify(this.scores))}addScore(e){const t={score:e,date:new Date().toISOString()},o=this.scores.findIndex(i=>i.score<e);return o===-1?this.scores.push(t):this.scores.splice(o,0,t),this.scores.length>this.maxEntries&&(this.scores=this.scores.slice(0,this.maxEntries)),this.saveScores(),{isHighScore:o===0,rank:o===-1?this.scores.length:o+1,isTopTen:o<this.maxEntries}}createLeaderboardUI(e){const t=document.createElement("div");t.style.marginTop="20px",t.style.marginBottom="30px",t.style.textAlign="center",t.style.color="white",t.style.fontFamily="Arial, sans-serif";const o=document.createElement("h2");o.textContent="High Scores",o.style.marginBottom="15px",t.appendChild(o);const i=document.createElement("div");if(i.style.display="flex",i.style.flexDirection="column",i.style.gap="5px",i.style.maxWidth="300px",i.style.margin="0 auto",i.style.marginBottom="30px",i.style.backgroundColor="rgba(0, 0, 0, 0.5)",i.style.padding="15px",i.style.borderRadius="8px",this.scores.forEach((a,s)=>{const n=document.createElement("div");n.style.display="flex",n.style.justifyContent="space-between",n.style.padding="5px",a.score===e&&(n.style.backgroundColor="rgba(255, 255, 255, 0.2)",n.style.borderRadius="4px");const c=document.createElement("span");c.textContent=`#${s+1}`,c.style.fontWeight="bold";const r=document.createElement("span");r.textContent=a.score.toLocaleString(),n.appendChild(c),n.appendChild(r),i.appendChild(n)}),t.appendChild(i),this.scores.some(a=>a.score===e)){const a=ft.createSocialButtons(e);a.style.marginTop="15px",t.appendChild(a)}return t}}const De=new wt,Se=[{name:"Cherry",radius:.4,color:14949143,points:1,emoji:"🍒",stemColor:4878371,shape:"cherry"},{name:"Strawberry",radius:.5,color:16719954,points:2,emoji:"🍓",leafColor:2972199,shape:"strawberry"},{name:"Grape",radius:.6,color:10040319,points:3,emoji:"🍇",shape:"grape"},{name:"Orange",radius:.65,color:16747520,points:4,emoji:"🍊",bumpScale:.05,shape:"orange"},{name:"Apple",radius:.85,color:16711680,points:5,emoji:"🍎",stemColor:4878371,shape:"apple"},{name:"Pear",radius:.95,color:16766720,points:6,emoji:"🍐",shape:"pear"},{name:"Peach",radius:1.2,color:16763812,points:7,emoji:"🍑",shape:"peach"},{name:"Pumpkin",radius:1.4,color:16741656,points:8,emoji:"🎃",stemColor:2263842,shape:"pumpkin"},{name:"Melon",radius:1.6,color:10026904,points:9,emoji:"🍈",stripeColor:2263842,shape:"melon"},{name:"Watermelon",radius:1.8,color:47917,points:10,emoji:"🍉",stripeColor:25600,shape:"watermelon"}];class bt{constructor(){this.fruits=[],this.currentFruit=null,this.mousePosition=new xe,this.mouseDown=!1,this.gameOver=!1,this.musicPlaying=!1,this.dropCooldown=!1,this.textureManager=new dt,this.scoreManager=new mt,this.lastDropTime=0,this.gameStarted=!1,this.animationFrameId=null,this.fruitFactory=null,this.lastTimestamp=0,this.recentFruits=[],this.maxRecentFruits=3,this.comboSystem=null}init(){this.scene=new He,this.camera=new Ue(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,g/2,7),this.camera.lookAt(0,g/2,0),this.setupLighting(),this.renderer=new $e({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(1710618),document.body.appendChild(this.renderer.domElement),X.init(),this.initPhysics(),this.fruitFactory=new gt(this.world,this.fruitMaterial,this.textureManager,this.scene),this.camera.position.set(0,g/2,12),this.camera.lookAt(0,g/2,0),this.createContainer(),this.nextFruitType=this.getRandomSmallFruit(),this.scoreManager.updateScore(0),this.raycaster=new _e,this.mousePlane=new Ye(new Q(0,0,1),0),this.intersectionPoint=new Q,window.addEventListener("resize",()=>this.onWindowResize()),window.addEventListener("mousemove",e=>this.onMouseMove(e)),window.addEventListener("click",()=>this.dropFruit()),this.comboSystem=new xt(this.scene),this.animate(0)}initPhysics(){this.world=new Xe({gravity:new f(0,-25,0)}),this.fruitMaterial=new Ae("fruit"),this.wallMaterial=new Ae("wall");const e=new ke(this.fruitMaterial,this.wallMaterial,{friction:.35,restitution:.25});this.world.addContactMaterial(e);const t=new ke(this.fruitMaterial,this.fruitMaterial,{friction:.5,restitution:.15,contactEquationStiffness:1e6,contactEquationRelaxation:3,frictionEquationStiffness:1e6,frictionEquationRelaxation:3});this.world.addContactMaterial(t),this.world.solver.iterations=20,this.world.solver.tolerance=.001,this.createContainerWalls()}createContainerWalls(){console.log("Creating container walls");const e=this.createWall(new f(0,0,0),new f(M/2+.5,.5,.5),this.wallMaterial);e.isWall=!0;const t=this.createWall(new f(-6/2-.5,g/2,0),new f(.5,g/2,.5),this.wallMaterial);t.isWall=!0;const o=this.createWall(new f(M/2+.5,g/2,0),new f(.5,g/2,.5),this.wallMaterial);o.isWall=!0;const i=this.createWall(new f(0,g/2,-4/2),new f(M/2+.5,g/2,.5),this.wallMaterial);i.isWall=!0;const a=new O({type:O.STATIC,shape:new be(new f(M*2,.1,F*2)),position:new f(0,-5,0),material:this.wallMaterial,isTrigger:!0,collisionResponse:!1});a.isSensor=!0,this.world.addBody(a),this.floorSensor=a}createWall(e,t,o=this.world.defaultMaterial){const i=new be(t),a=new O({mass:0,shape:i,material:o,position:e});return a.isWall=!0,this.world.addBody(a),a}setupLighting(){const e=new je(16777215,rt);e.position.set(5,10,5),e.castShadow=!0,this.scene.add(e);const t=new Ke(16777215,ct);this.scene.add(t);const o=new Qe(16777215,lt,15);o.position.set(0,g,2),this.scene.add(o);const i=new Je(16777215,ut);i.position.set(0,g+3,5),i.angle=Math.PI/4,i.penumbra=.1,i.decay=2,i.distance=20,i.target.position.set(0,g/2,0),this.scene.add(i),this.scene.add(i.target)}createContainer(){const o=new O({type:O.STATIC,material:this.wallMaterial}),i=new be(new f(M/2,.2,F/2));o.addShape(i,new f(0,0,0)),o.position.set(0,0,0),o.isWall=!0,this.world.addBody(o),this.createWall(new f(-3.2,g/2,0),new f(.2,g/2,F/2)),this.createWall(new f(M/2+.2,g/2,0),new f(.2,g/2,F/2)),this.createWall(new f(0,g/2,-4/2),new f(M/2+.2,g/2,.2)),this.createPaperBag()}createPaperBag(){const e=this.textureManager.paperTexture,t=new L({color:it,metalness:0,roughness:.7,map:e,side:J,emissive:ot,emissiveIntensity:at}),o=new w(new Ze(M,.1,F),t);o.position.set(0,.05,0),this.scene.add(o);const i=new w(new K(F,g),t);i.position.set(-6/2,g/2,0),i.rotation.y=Math.PI/2,this.scene.add(i);const a=new w(new K(F,g),t);a.position.set(M/2,g/2,0),a.rotation.y=-Math.PI/2,this.scene.add(a);const s=new w(new K(M,g),t);s.position.set(0,g/2,-4/2),this.scene.add(s);const n=.6,c=new w(new K(F,n),t);c.position.set(-6/2,g+n/2,0),c.rotation.y=Math.PI/2,c.rotation.x=Math.PI/8,this.scene.add(c);const r=new w(new K(F,n),t);r.position.set(M/2,g+n/2,0),r.rotation.y=-Math.PI/2,r.rotation.x=Math.PI/8,this.scene.add(r);const l=new w(new K(M,n),t);l.position.set(0,g+n/2,-4/2),l.rotation.x=Math.PI/8,this.scene.add(l);const h=(u,m,p,x,P,b)=>{const A=new w(new K(u,m),new ve({color:8084284,transparent:!0,opacity:.3,side:J}));A.position.set(p,x,P),A.rotation.y=b||0,this.scene.add(A)};h(M/2,.05,-6/4,g/2,-4/2+.01),h(M/2,.05,M/4,g/2,-4/2+.01),h(F/2,.05,-6/2-.01,g/2,-4/4,Math.PI/2),h(F/2,.05,-6/2-.01,g/2,F/4,Math.PI/2),h(F/2,.05,M/2+.01,g/2,-4/4,Math.PI/2),h(F/2,.05,M/2+.01,g/2,F/4,Math.PI/2)}getRandomSmallFruit(){const e=Se.slice(0,3);if(this.recentFruits.length>0){const o=this.recentFruits[0],i=e.filter(s=>s.name!==o.name),a=i[Math.floor(Math.random()*i.length)];return this.recentFruits.unshift({name:a.name}),this.recentFruits.length>this.maxRecentFruits&&this.recentFruits.pop(),a}const t=e[Math.floor(Math.random()*e.length)];return this.recentFruits.unshift({name:t.name}),t}updateScore(e){this.scoreManager.updateScore(e)}createFruitGeometry(e){switch(e.shape){case"cherry":return this.fruitFactory.createFruitGeometry(e);case"strawberry":return this.fruitFactory.createFruitGeometry(e);case"orange":return this.fruitFactory.createFruitGeometry(e);case"watermelon":return this.fruitFactory.createFruitGeometry(e);case"grape":return this.fruitFactory.createFruitGeometry(e);case"apple":return this.fruitFactory.createFruitGeometry(e);case"pear":return this.fruitFactory.createFruitGeometry(e);case"peach":return this.fruitFactory.createFruitGeometry(e);case"melon":return this.fruitFactory.createFruitGeometry(e);case"pumpkin":return this.fruitFactory.createFruitGeometry(e);default:{const t=new N(e.radius,32,32),o=new E({color:e.color});return new w(t,o)}}}createFruitBody(e,t,o=!1,i){this.world||(console.log("World not initialized, initializing physics first"),this.initPhysics());let a,s;return a=new Me(e),this.world?(s=new O({mass:1,shape:a,position:new f(t.x,t.y,0),material:this.fruitMaterial,linearDamping:.1,angularDamping:.05,collisionFilterGroup:o?0:1,collisionFilterMask:o?0:1}),s.lastCollisionTime=0,s.collisionCooldown=100,s.creationTime=Date.now(),s.addEventListener("collide",n=>{if(!this.world)return;s.velocity.z=0,s.position.z=0;const c=Date.now();n.body&&n.body.material===this.wallMaterial&&c-s.lastCollisionTime>s.collisionCooldown&&(typeof X<"u"&&X&&X.playSound("hit"),s.lastCollisionTime=c)}),this.world.addBody(s),s):(console.error("Failed to create physics body - world is null"),{position:new f(t.x,t.y,0),quaternion:new fe,velocity:new f(0,0,0),angularVelocity:new f(0,0,0),type:0,addEventListener:()=>{},fixedRotation:!1,updateMassProperties:()=>{}})}createFruit(e,t,o=!1){if(!this.scene)return console.error("Scene is not initialized - cannot create fruit"),{mesh:{position:t,quaternion:new Ce},body:{position:new f(t.x,t.y,0),quaternion:new fe,velocity:new f(0,0,0),angularVelocity:new f(0,0,0),type:0,addEventListener:()=>{}},type:e};try{const i=this.createFruitGeometry(e);i.position.copy(t);const a=this.createFruitBody(e.radius,t,o,e);o&&i.traverse(n=>{n.isMesh&&n.material&&(n.material=n.material.clone(),n.material.transparent=!0,n.material.opacity=.7)}),this.scene&&this.scene.add(i);const s={mesh:i,body:a,type:e,dropTime:null};return o||this.fruits.push(s),s}catch(i){return console.error("Error creating fruit:",i),{mesh:{position:t,quaternion:new Ce},body:{position:new f(t.x,t.y,0),quaternion:new fe,velocity:new f(0,0,0),angularVelocity:new f(0,0,0),type:0,addEventListener:()=>{}},type:e}}}checkFruitCombinations(){let e=0;const t=new Set;for(let o=0;o<this.fruits.length;o++){const i=this.fruits[o];if(!(!i.body||!i.mesh))for(let a=o+1;a<this.fruits.length;a++){const s=this.fruits[a];if(!s.body||!s.mesh)continue;const n=`${i.id}-${s.id}`;if(t.has(n))continue;if(i.mesh.position.distanceTo(s.mesh.position)<i.type.radius+s.type.radius&&i.type.name===s.type.name){t.add(n);const r=new Q().addVectors(i.mesh.position,s.mesh.position).multiplyScalar(.5);this.removeFruit(i),this.removeFruit(s);const l=Se[Se.findIndex(h=>h.name===i.type.name)+1];if(l){this.createFruit(l,r),e++;const h=this.comboSystem.incrementCombo(r,l.color),u=l.points,m=Math.floor(u*(h-1));this.scoreManager.addPoints(u+m),X.playMergeSound()}}}}return e}checkGameOver(){const e=this.fruits.some(o=>{const i=o.body.position.y>tt,a=o.body.velocity.lengthSquared()<.1,n=Date.now()-o.body.creationTime<1e3;return i&&a&&!n}),t=this.fruits.some(o=>o.body.position.y<-2||o.body.position.y<0&&Math.abs(o.body.position.x)>M/2+.5);(e||t)&&!this.gameOver&&(this.gameOver=!0,console.log("Game over triggered"),console.log(t?"Game over caused by fruit falling out of container":"Game over caused by fruit above height limit"),this.showGameOverScreen())}showGameOverScreen(){const e=document.getElementById("game-over");e.innerHTML="",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="center",e.style.color="white",e.style.backgroundColor="rgba(0, 0, 0, 0.7)";const t=document.createElement("h1");t.innerText="Game Over",t.style.color="white",t.style.marginBottom="10px";const o=this.scoreManager.getCurrentScore(),i=document.createElement("div");i.innerText=`Final Score: ${o}`,i.style.fontSize="24px",i.style.margin="10px 0",i.style.color="white";const a=De.addScore(o),s=document.createElement("div");a.isHighScore?(s.innerText="🏆 New High Score! 🏆",s.style.color="#FFD700"):a.isTopTen&&(s.innerText=`🌟 Top ${a.rank} Score! 🌟`,s.style.color="#FFA500"),s.style.fontSize="20px",s.style.marginBottom="10px";const n=document.createElement("button");n.id="restart-button",n.innerText="Play Again",n.style.marginTop="10px",n.style.marginBottom="40px",n.style.padding="12px 30px",n.style.fontSize="18px",n.style.backgroundColor="#4CAF50",n.style.color="white",n.style.border="none",n.style.borderRadius="8px",n.style.cursor="pointer",n.style.transition="background-color 0.3s",e.appendChild(t),e.appendChild(i),(a.isHighScore||a.isTopTen)&&e.appendChild(s);const c=De.createLeaderboardUI(o);e.appendChild(c),e.appendChild(n),n.addEventListener("click",()=>{location.reload()})}preventBottomClipping(){for(const e of this.fruits)if(e.body&&e.body.position.y<.5&&e.body.velocity.y<=.1){const o=.05+Math.max(0,.5-e.body.position.y)*.2;e.body.applyForce(new f(0,o,0),e.body.position),e.body.position.y<.05&&(e.body.position.y=.05,e.body.velocity.y<0&&(e.body.velocity.y=0))}}stabilizeStackedFruits(){for(const e of this.fruits){if(!e.body||e.dropTime&&Date.now()-e.dropTime<2e3)continue;const t=e.body.velocity.length(),o=e.body.angularVelocity.length();let i=0,a=!1,s=!1;if(e.body.world&&e.body.world.contacts)for(let n=0;n<e.body.world.contacts.length;n++){const c=e.body.world.contacts[n];if(c.bi===e.body||c.bj===e.body){i++,c.bi===e.body?c.bj:c.bi;const r=c.ni.y;r>.7?a=!0:Math.abs(r)<.3&&(s=!0)}}t<.3&&a&&s&&i>=3&&(e.body.linearDamping=.9,e.body.angularDamping=.9,t>.1&&e.body.velocity.scale(.9,e.body.velocity),o>.3&&e.body.angularVelocity.scale(.8,e.body.angularVelocity),e.body.position.y<g/4&&Date.now()-e.dropTime>5e3&&i>4&&(e.body.velocity.scale(.5,e.body.velocity),e.body.angularVelocity.scale(.5,e.body.angularVelocity)))}}dispose(){console.log("Disposing game resources"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),window.removeEventListener("mousemove",this.onMouseMoveBound),document.removeEventListener("keydown",this.keyDownHandler),document.removeEventListener("click",this.clickHandler),window.removeEventListener("resize",this.onWindowResizeBound),this.scene&&this.scene.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.map&&t.map.dispose(),t.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.dispose()))}),this.renderer&&(this.renderer.dispose(),document.body.removeChild(this.renderer.domElement)),this.comboSystem&&this.comboSystem.dispose(),this.fruits=[],this.currentFruit=null}removeFruit(e){this.scene.remove(e.mesh),this.world.removeBody(e.body),this.fruits=this.fruits.filter(t=>t!==e)}spawnFruit(){if(this.gameOver||this.currentFruit)return;this.nextFruitType||this.generateNextFruit();let e=0;if(this.intersectionPoint){const o=this.nextFruitType?this.nextFruitType.radius:.5,a=M/2-o-.5;e=Math.max(-a,Math.min(a,this.intersectionPoint.x))}const t=new Q(e,g+1,0);this.currentFruit=this.fruitFactory.createFruit(this.nextFruitType,t,!0),this.currentFruit.body.type=O.KINEMATIC,this.currentFruit.body.velocity.set(0,0,0),this.currentFruit.body.angularVelocity.set(0,0,0),this.generateNextFruit()}initDebugPanel(){}onMouseMove(e){if(this.gameOver)return;this.mousePosition.x=e.clientX/window.innerWidth*2-1,this.mousePosition.y=-(e.clientY/window.innerHeight*2-1),this.raycaster.setFromCamera(this.mousePosition,this.camera),this.raycaster.ray.intersectPlane(this.mousePlane,this.intersectionPoint);const t=this.nextFruitType?this.nextFruitType.radius:.5,i=M/2-t-.5,a=Math.max(-i,Math.min(i,this.intersectionPoint.x));if(this.currentFruit)this.currentFruit.mesh.position.x=a,this.currentFruit.body.position.x=a,this.currentFruit.mesh.position.y=g+1,this.currentFruit.mesh.position.z=0,this.currentFruit.body.position.y=g+1,this.currentFruit.body.position.z=0;else{const s=new Q(a,g+1,0);this.currentFruit=this.fruitFactory.createFruit(this.nextFruitType,s,!0),this.currentFruit.body.type=O.KINEMATIC,this.currentFruit.body.velocity.set(0,0,0),this.currentFruit.body.angularVelocity.set(0,0,0)}}dropFruit(){if(this.gameOver||this.dropCooldown)return;const e=Date.now();if(!(e-this.lastDropTime<et)&&this.currentFruit){this.dropCooldown=!0,this.lastDropTime=e;try{this.currentFruit.body.type=O.DYNAMIC,this.currentFruit.body.collisionFilterGroup=1,this.currentFruit.body.collisionFilterMask=1,this.currentFruit.body.angularDamping=.1,this.currentFruit.dropTime=e,this.currentFruit.mesh&&typeof this.currentFruit.mesh.traverse=="function"&&this.currentFruit.mesh.traverse(t=>{t.isMesh&&t.material&&(t.material=t.material.clone(),t.material.opacity=1)}),this.currentFruit.body.position.z=0,this.currentFruit.mesh&&(this.currentFruit.mesh.position.z=0),this.currentFruit.body.velocity.set(0,-1,0),this.currentFruit.body.angularVelocity.set(0,0,(Math.random()-.5)*10),this.currentFruit.body.fixedRotation=!1,typeof this.currentFruit.body.updateMassProperties=="function"&&this.currentFruit.body.updateMassProperties(),X.playDropSound(),this.fruits.push(this.currentFruit),this.currentFruit=null,setTimeout(()=>{this.dropCooldown=!1,this.gameOver||this.spawnFruit()},Ge)}catch(t){console.error("Error dropping fruit:",t),this.currentFruit=null,setTimeout(()=>{this.dropCooldown=!1,this.gameOver||this.spawnFruit()},Ge)}}}onWindowResize(){this.gameOver||(this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight))}animate(e){if(this.gameOver)return;this.animationFrameId=requestAnimationFrame(o=>this.animate(o)),this.lastTimestamp||(this.lastTimestamp=e||0);const t=e?Math.min((e-this.lastTimestamp)/1e3,.1):1/60;if(this.lastTimestamp=e||0,this.world){this.world.step(.016666666666666666,t,3);for(const a of this.fruits)a.body.position.z!==0&&(a.body.position.z=0,a.mesh.position.z=0),a.body.velocity.z!==0&&(a.body.velocity.z=0);for(const a of this.fruits)a.body&&a.mesh&&(a.mesh.position.copy(a.body.position),a.mesh.quaternion.copy(a.body.quaternion))}this.fruitFactory.update(),this.checkFruitCombinations(),this.checkGameOver(),this.preventBottomClipping(),this.stabilizeStackedFruits(),this.comboSystem&&this.comboSystem.update(),this.renderer.render(this.scene,this.camera)}generateNextFruit(){const e=this.nextFruitType;do this.nextFruitType=this.getRandomSmallFruit();while(e&&this.nextFruitType.name===e.name);const t=document.getElementById("next-fruit");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);t.textContent=`Next: ${this.nextFruitType.name}`}}}let Te;document.addEventListener("DOMContentLoaded",()=>{const G=document.getElementById("score"),e=document.getElementById("next-fruit");G.textContent="Score: 0",G.style.display="block",e.style.display="block",Te=new bt,Te.init(),Te.animate(0);const t=()=>{X.init(),X.playBackgroundMusic(),document.removeEventListener("click",t),document.removeEventListener("touchstart",t),document.removeEventListener("keydown",t)};document.addEventListener("click",t),document.addEventListener("touchstart",t),document.addEventListener("keydown",t)});
//# sourceMappingURL=index-ywvCOTzt.js.map
